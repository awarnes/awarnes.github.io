<!DOCTYPE html>
<html>
    <head>
        <title>360 Image Viewer</title>
        <meta author='Alex Warnes'>
        <!-- A-Frame Dependencies -->
        <script src="https://aframe.io/releases/0.5.0/aframe.min.js"></script>
        <script src="https://npmcdn.com/aframe-animation-component@3.0.1"></script>
        <script src="https://npmcdn.com/aframe-event-set-component@3.0.1"></script>
        <script src="https://npmcdn.com/aframe-layout-component@3.0.1"></script>
        <script src="https://npmcdn.com/aframe-template-component@3.1.1"></script>
        <script src="components/set-image.js"></script>
        <script>
            AFRAME.registerComponent('set-image', {
                schema:{
                    on: {type: 'string'},
                    target: {type: 'selector'},
                    src: {type: 'string'},
                    dur: {type: 'number', default: 300}
                },

                init: function (){
                    var data = this.data;
                    var el = this.el;

                    this.setupFadeAnimation();

                    el.addEventListener(data.on, function() {
                        // Fade out image.
                        data.target.emit('set-image-fade');
                        // Wait for fade to complete.
                        setTimeout(function () {
                            // Set Image.
                            data.target.setAttribute('material', 'src', data.src);
                        }, data.dur);
                    });
                },

                setupFadeAnimation: function() {
                    // Appends an a-animation that fades to black.
                    var data = this.data;
                    var targetEl = this.data.target;

                    // Only set up once.
                    if (targetEl.dataset.setImageFadeSetup) { return; }
                    targetEl.dataset.setImageFadeSetup = true;

                    // Create animation.
                    targetEl.setAttribute('animation__fade', {
                      property: 'material.color',
                      startEvents: 'set-image-fade',
                      dir: 'alternate',
                      dur: data.dur,
                      from: '#FFF',
                      to: '#000'
                    });
                }
            })
        </script>
    </head>
    
    <body>
        
        <a-scene>
        
            <a-assets>
                <audio id='click-sound' crossorigin="anonymous" src='https://cdn.aframe.io/360-image-gallery-boilerplate/audio/click.ogg'></audio>
                
                <!--Images-->
                <img id='curses' src='./img/curses.png'>
                <img id='curses-thumb' src='./img/curses.png'>
                <img id='deck' src='./img/deck.png'>
                <img id='deck-thumb' src='./img/deck.png'>
                <img id='poca' src='./img/poca.png'>
                <img id='poca-thumb' src='./img/poca.png'>
                <img id='twitter_api' src='./img/twitter_api.png'>
                <img id='twitter_api-thumb' src='./img/twitter_api.png'>
                <img id='office-sky' src='./img/pdx-office-360.JPG'>
                
                <script id='plane' type='text/html'>
                    <a-entity class='link'
                      geometry='primitive: plane; height: 1; width: 1'
                      material='shader: flat; src: ${thumb}'
                      event-set__1='_event: mousedown; scale: 1 1 1'
                      event-set__2='_event: mouseup; scale: 1.2 1.2 1'
                      event-set__3='_event: mouseenter; scale: 1.2 1.2 1'
                      event-set__4='_event: mouseleave; scale: 1 1 1'
                      event-set__5='_event: click; scale: 10 10 10'></a-entity>
                      sound='on: click; src: #click-sound'
                </script>

            </a-assets>
            
            <a-sky id='image-360' radius='15' src='#office-sky'></a-sky>
            
            <a-entity id='links' rotation='0 90 0'  layout='layout: grid; margin: 2' position='-8 1 4'>
                
                <a-entity template='src: #plane' data-thumb='#curses-thumb'></a-entity>
                <a-entity template='src: #plane' data-thumb='#deck-thumb'></a-entity>
                <a-entity template='src: #plane' data-thumb='#poca-thumb'></a-entity>
                <a-entity template='src: #plane' data-thumb='#twitter_api-thumb'></a-entity>

            </a-entity>
            
            <a-entity camera look-controls>
                    <a-cursor id='cursor'>
                        <a-animation begin='click' easing='ease-in' attribute='scale' fill='backwards' from='0.1 0.1 0.1' to='1 1 1' dur='1500'></a-animation>
                        <a-animation begin='cursor-fusing' easing='ease-in' attribute='scale' from='1 1 1' to='0.1 0.1 0.1' dur='1500'></a-animation>
                    </a-cursor>
            </a-entity>
        </a-scene>
    </body>
</html>

